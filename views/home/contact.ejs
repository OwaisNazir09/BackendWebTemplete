<section class="school-info-section">
  <!-- PAGE HEADER -->
  <div class="page-header mb-4">
    <h1 class="page-title">
      <i class="fas fa-address-book text-primary me-2"></i> Contact Management
    </h1>
  </div>

  <!-- âž• ADD CONTACT -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white border-bottom">
      <h5 class="mb-0 fw-semibold text-dark">
        <i class="fas fa-plus-circle text-primary me-2"></i> Add / Update Contact
      </h5>
    </div>

    <div class="card-body p-4">
      <form action="/home/contact" method="POST" class="row g-4">
        <div class="col-md-12">
          <label class="form-label fw-semibold">School Address</label>
          <textarea name="address" rows="2" class="form-control shadow-sm" placeholder="Enter full address" required><%= data && data[0] ? data[0].address : '' %></textarea>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">Email</label>
          <input type="email" name="email" class="form-control shadow-sm" placeholder="example@school.com" value="<%= data && data[0] ? data[0].email : '' %>" required />
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">Phone Number</label>
          <input type="text" name="phone" class="form-control shadow-sm" placeholder="+91 9876543210" value="<%= data && data[0] ? data[0].phone : '' %>" required />
        </div>

        <div class="col-md-12">
          <label class="form-label fw-semibold">Google Map Embed Code</label>
          <textarea name="mapEmbed" rows="3" class="form-control shadow-sm" placeholder='Paste Google Map embed iframe here'><%= data && data[0] ? data[0].mapEmbed : '' %></textarea>
          <small class="text-muted">Get this from Google Maps â†’ Share â†’ Embed a map â†’ Copy HTML.</small>
        </div>

        <div class="col-12 text-end mt-3">
          <button class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> <%= data && data.length > 0 ? "Update" : "Save" %>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ðŸ§¾ EXISTING CONTACT DETAILS -->
  <% if (data && data.length > 0) { %>
    <div class="card shadow-sm border-0">
      <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-dark fw-semibold">
          <i class="fas fa-list text-primary me-2"></i> Existing Contact Details
        </h5>
      </div>

      <div class="card-body">
        <div class="row g-4">
          <% data.forEach(item => { %>
            <div class="col-md-6 col-lg-4">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3">
                  <h6 class="fw-bold mb-2"><i class="fas fa-map-marker-alt text-primary me-2"></i> Address</h6>
                  <p class="text-muted small"><%= item.address %></p>

                  <h6 class="fw-bold mb-2"><i class="fas fa-envelope text-primary me-2"></i> Email</h6>
                  <p class="text-muted small"><%= item.email %></p>

                  <h6 class="fw-bold mb-2"><i class="fas fa-phone text-primary me-2"></i> Phone</h6>
                  <p class="text-muted small mb-3"><%= item.phone %></p>

                  <div class="d-flex justify-content-between">
                    <!-- Edit -->
                    <button
                      class="btn btn-sm btn-outline-primary"
                      data-bs-toggle="modal"
                      data-bs-target="#editModal"
                      data-id="<%= item._id %>"
                      data-address="<%= item.address %>"
                      data-email="<%= item.email %>"
                      data-phone="<%= item.phone %>"
                      data-map="<%- item.mapEmbed ? item.mapEmbed.replace(/"/g, '&quot;') : '' %>"
                    >
                      <i class="fas fa-edit"></i>
                    </button>

                    <!-- Delete -->
                    <a href="/home/contact/<%= item._id %>"
                      class="btn btn-sm btn-outline-danger"
                      onclick="return confirm('Are you sure you want to delete this contact information?');">
                      <i class="fas fa-trash"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <% if (item.mapEmbed) { %>
              <div class="col-md-6 col-lg-8">
                <div class="ratio ratio-16x9 rounded overflow-hidden shadow-sm">
                  <%- item.mapEmbed %>
                </div>
              </div>
            <% } %>
          <% }) %>
        </div>
      </div>
    </div>
  <% } else { %>
    <p class="text-muted">No contact details have been added yet.</p>
  <% } %>
</section>

<!-- âœï¸ EDIT CONTACT MODAL -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <form id="editForm" method="POST">
        <input type="hidden" name="_method" value="PUT" />
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">
            <i class="fas fa-edit me-2 text-primary"></i>Edit Contact Details
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body row g-3">
          <div class="col-md-12">
            <label class="form-label fw-semibold">Address</label>
            <textarea name="address" id="editAddress" rows="2" class="form-control shadow-sm"></textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Email</label>
            <input type="email" name="email" id="editEmail" class="form-control shadow-sm" />
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Phone</label>
            <input type="text" name="phone" id="editPhone" class="form-control shadow-sm" />
          </div>
          <div class="col-md-12">
            <label class="form-label fw-semibold">Map Embed (iframe)</label>
            <textarea name="mapEmbed" id="editMap" rows="3" class="form-control shadow-sm"></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary"><i class="fas fa-save me-2"></i> Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const editModal = document.getElementById("editModal");
  const editForm = document.getElementById("editForm");

  editModal.addEventListener("show.bs.modal", function (event) {
    const button = event.relatedTarget;
    const id = button.getAttribute("data-id");
    const address = button.getAttribute("data-address");
    const email = button.getAttribute("data-email");
    const phone = button.getAttribute("data-phone");
    const map = button.getAttribute("data-map");

    editForm.action = `/home/contact/${id}`;
    editForm.querySelector("#editAddress").value = address || "";
    editForm.querySelector("#editEmail").value = email || "";
    editForm.querySelector("#editPhone").value = phone || "";
    editForm.querySelector("#editMap").value = map || "";
  });
</script>
