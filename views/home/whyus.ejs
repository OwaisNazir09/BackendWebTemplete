<section class="school-info-section">
  <div class="page-header mb-4">
    <h1 class="page-title">
      <i class="fas fa-lightbulb text-primary me-2"></i> Why Us Management
    </h1>
  </div>

  <!-- ADD NEW WHY US -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white border-bottom">
      <h5 class="mb-0 fw-semibold text-dark">
        <i class="fas fa-plus-circle text-primary me-2"></i> Add New Point
      </h5>
    </div>

    <div class="card-body p-4">
      <form action="/home/whyus" method="POST" class="row g-4">
        <div class="col-md-6">
          <label class="form-label fw-semibold">Title</label>
          <input type="text" name="title" class="form-control shadow-sm" required />
        </div>

        <div class="col-md-12">
          <label class="form-label fw-semibold">Description</label>
          <textarea name="description" rows="3" class="form-control shadow-sm"></textarea>
        </div>

        <!-- ICON PICKER -->
        <div class="col-md-12">
          <label class="form-label fw-semibold">Choose an Icon</label>
          <input type="hidden" name="icon" id="selectedIcon" />

          <div id="iconPicker" class="d-flex flex-wrap gap-2 p-2 border rounded shadow-sm bg-light" style="max-height: 240px; overflow-y: auto;">
            <% const icons = [
              // Education
              'fa-solid fa-school', 'fa-solid fa-book', 'fa-solid fa-book-open', 'fa-solid fa-graduation-cap', 'fa-solid fa-pencil',
              'fa-solid fa-chalkboard', 'fa-solid fa-chalkboard-teacher', 'fa-solid fa-user-graduate', 'fa-solid fa-lightbulb', 'fa-solid fa-laptop',
              
              // Awards / Recognition
              'fa-solid fa-trophy', 'fa-solid fa-award', 'fa-solid fa-medal', 'fa-solid fa-certificate', 'fa-solid fa-star', 'fa-solid fa-crown',

              // People & Values
              'fa-solid fa-user', 'fa-solid fa-users', 'fa-solid fa-children', 'fa-solid fa-handshake', 'fa-solid fa-heart',
              'fa-solid fa-hands-praying', 'fa-solid fa-hands-holding-child', 'fa-solid fa-people-group', 'fa-solid fa-shield-heart', 'fa-solid fa-hands-holding',

              // Facilities
              'fa-solid fa-building', 'fa-solid fa-city', 'fa-solid fa-door-open', 'fa-solid fa-house', 'fa-solid fa-tree', 'fa-solid fa-bus',
              'fa-solid fa-car', 'fa-solid fa-bicycle', 'fa-solid fa-volleyball-ball', 'fa-solid fa-basketball-ball', 'fa-solid fa-football-ball',

              // Innovation & Science
              'fa-solid fa-atom', 'fa-solid fa-flask', 'fa-solid fa-microscope', 'fa-solid fa-rocket', 'fa-solid fa-gear', 'fa-solid fa-gears',
              'fa-solid fa-brain', 'fa-solid fa-lightbulb', 'fa-solid fa-compass-drafting', 'fa-solid fa-palette', 'fa-solid fa-paint-brush',

              // Communication & Global
              'fa-solid fa-comments', 'fa-solid fa-comment-dots', 'fa-solid fa-bullhorn', 'fa-solid fa-globe', 'fa-solid fa-map', 'fa-solid fa-location-dot',
              'fa-solid fa-paper-plane', 'fa-solid fa-envelope', 'fa-solid fa-phone', 'fa-solid fa-network-wired', 'fa-solid fa-satellite-dish',

              // Technology
              'fa-solid fa-robot', 'fa-solid fa-server', 'fa-solid fa-code', 'fa-solid fa-database', 'fa-solid fa-cloud', 'fa-solid fa-bolt',
              'fa-solid fa-microchip', 'fa-solid fa-wifi', 'fa-solid fa-print', 'fa-solid fa-mobile-screen', 'fa-solid fa-keyboard',

              // Faith & Morality
              'fa-solid fa-cross', 'fa-solid fa-hands', 'fa-solid fa-heart-circle-check', 'fa-solid fa-praying-hands', 'fa-solid fa-leaf', 'fa-solid fa-dove',
              'fa-solid fa-scale-balanced', 'fa-solid fa-pray', 'fa-solid fa-book-bible', 'fa-solid fa-star-of-david',

              // Misc
              'fa-solid fa-clock', 'fa-solid fa-calendar', 'fa-solid fa-bell', 'fa-solid fa-face-smile', 'fa-solid fa-face-laugh-beam',
              'fa-solid fa-face-grin-stars', 'fa-solid fa-circle', 'fa-solid fa-square', 'fa-solid fa-triangle-exclamation', 'fa-solid fa-infinity'
            ]; %>

            <% icons.forEach(ic => { %>
              <div class="icon-option border rounded d-flex align-items-center justify-content-center bg-white"
                   style="cursor:pointer;width:38px;height:38px;">
                <i class="<%= ic %> text-secondary"></i>
              </div>
            <% }) %>
          </div>

          <small class="text-muted mt-2 d-block">Click an icon to select it (scroll for more).</small>
        </div>

        <div class="col-12 text-end mt-3">
          <button class="btn btn-primary px-4">
            <i class="fas fa-save me-2"></i> Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- EXISTING WHY US POINTS -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-white border-bottom">
      <h5 class="mb-0 fw-semibold text-dark">
        <i class="fas fa-list text-primary me-2"></i> Existing Points
      </h5>
    </div>

    <div class="card-body">
      <% if (data && data.length > 0) { %>
        <div class="row g-4">
          <% data.forEach(item => { %>
            <div class="col-md-4">
              <div class="card border-0 shadow-sm h-100 text-center p-3">
                <i class="<%= item.icon || 'fa-solid fa-star' %> fa-2x text-primary mb-3"></i>
                <h6 class="fw-bold mb-1"><%= item.title %></h6>
                <p class="text-muted small"><%= item.description %></p>

                <div class="d-flex justify-content-center gap-2 mt-3">
                  <button
                    class="btn btn-sm btn-outline-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#editModal"
                    data-id="<%= item._id %>"
                    data-title="<%= item.title %>"
                    data-description="<%= item.description %>"
                    data-icon="<%= item.icon %>"
                  >
                    <i class="fas fa-edit"></i>
                  </button>

                  <a href="/home/whyus/<%= item._id %>"
                     class="btn btn-sm btn-outline-danger"
                     onclick="return confirm('Are you sure you want to delete this entry?');">
                    <i class="fas fa-trash"></i>
                  </a>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p class="text-muted">No entries yet.</p>
      <% } %>
    </div>
  </div>
</section>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <form id="editForm" method="POST">
        <input type="hidden" name="_method" value="PUT" />
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-edit me-2 text-primary"></i>Edit Why Us Point</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-12">
            <label class="form-label fw-semibold">Title</label>
            <input type="text" name="title" id="editTitle" class="form-control shadow-sm" required />
          </div>
          <div class="col-md-12">
            <label class="form-label fw-semibold">Description</label>
            <textarea name="description" id="editDescription" rows="3" class="form-control shadow-sm"></textarea>
          </div>
          <div class="col-md-12">
            <label class="form-label fw-semibold">Icon Class</label>
            <input type="text" name="icon" id="editIcon" class="form-control shadow-sm" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary"><i class="fas fa-save me-2"></i> Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Icon Picker Selection
  const iconOptions = document.querySelectorAll(".icon-option");
  const selectedIconInput = document.getElementById("selectedIcon");

  iconOptions.forEach((iconDiv) => {
    iconDiv.addEventListener("click", () => {
      iconOptions.forEach(opt => opt.classList.remove("border-primary", "bg-primary-subtle"));
      iconDiv.classList.add("border-primary", "bg-primary-subtle");
      const iconClass = iconDiv.querySelector("i").className;
      selectedIconInput.value = iconClass;
    });
  });

  // Edit Modal Logic
  const editModal = document.getElementById("editModal");
  const editForm = document.getElementById("editForm");
  editModal.addEventListener("show.bs.modal", function (event) {
    const button = event.relatedTarget;
    const id = button.getAttribute("data-id");
    const title = button.getAttribute("data-title");
    const description = button.getAttribute("data-description");
    const icon = button.getAttribute("data-icon");

    editForm.action = `/home/whyus/${id}`;
    editForm.querySelector("#editTitle").value = title || "";
    editForm.querySelector("#editDescription").value = description || "";
    editForm.querySelector("#editIcon").value = icon || "";
  });
</script>
